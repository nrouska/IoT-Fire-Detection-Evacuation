<div>
    <h1><b>Configure: {{deviceId}}</b></h1>
    <span style="background: #eee; padding: 5px; border-radius: 4px;">Type: {{deviceType}}</span>
</div>

<div style="display: flex; gap: 1rem; margin-top: 1rem; height: 600px;">
    
    <div id="map" style="flex: 3; border: 1px solid #ccc; border-radius: 4px;"></div>

    <div style="flex: 1; padding: 1rem; background: #fff; border: 1px solid #ddd; border-radius: 4px; display: flex; flex-direction: column; gap: 15px;">
        
        <h3 style="margin-top: 0;">Position</h3>
        <div>
            <label style="font-size:0.8em; color:gray;">Latitude</label>
            <input type="number" id="latInput" readonly style="width: 100%; padding: 5px; background: #eee;">
        </div>
        <div>
            <label style="font-size:0.8em; color:gray;">Longitude</label>
            <input type="number" id="lngInput" readonly style="width: 100%; padding: 5px; background: #eee;">
        </div>

        <div id="apSettings" style="display: none; background: #f9f9f9; padding: 10px; border-radius: 4px; border: 1px solid #ddd; margin-top: 10px;">
            <h4 style="margin: 0 0 10px 0; color: #333;">Link to Building</h4>
            
            <p style="font-size: 0.8em; margin: 0 0 5px 0; color: #666;">
                Select the building this AP monitors. The crowd count will be assigned to it.
            </p>
            
            <p style="font-size: 0.85em; color: #333; font-weight: bold; margin-bottom: 5px;">
                 Click a building on the map:
            </p>
            
            <div style="background: white; padding: 8px; border: 1px solid #ccc; border-radius: 4px; display: flex; align-items: center; gap: 10px;">
                <span class="material-symbols-outlined" style="color: #555;">apartment</span>
                <span id="selectedBuildingDisplay" style="font-weight: bold; color: #333;">None Selected</span>
            </div>
            
            <input type="hidden" id="linkedBuildingInput">
        </div>

        <div id="radarSettings" style="display: none; background: #fff0e6; padding: 10px; border-radius: 4px; border: 1px solid #ffccb3; margin-top: 10px;">
            <h4 style="margin: 0 0 10px 0; color: #d35400;">Link to Building Door</h4>
            
            <p style="font-size: 0.8em; margin: 0 0 5px 0; color: #666;">
                Select the specific door this radar is monitoring.
            </p>
            
            <p style="font-size: 0.85em; color: #333; font-weight: bold; margin-bottom: 5px;">
                 Click a <span style="color: #d35400;">Red Dot</span> on the building:
            </p>
            
            <div style="background: white; padding: 8px; border: 1px solid #ccc; border-radius: 4px; display: flex; align-items: center; gap: 10px;">
                <span class="material-symbols-outlined" style="color: #d35400;">door_front</span>
                <span id="selectedDoorDisplay" style="font-weight: bold; color: #333;">None Selected</span>
            </div>
            
            <input type="hidden" id="linkedDoorInput">
        </div>

        <div id="cameraSpecificSettings">
            <div>
                <label style="font-size:0.8em; color:gray;">Camera Height (meters)</label>
                <input type="number" id="camHeightInput" step="0.1" placeholder="e.g. 3.0" value="{{camHeight}}" style="width: 100%; padding: 5px; border: 1px solid #ccc;">
            </div>

            <hr style="width: 100%; border: 0; border-top: 1px solid #eee; margin: 15px 0;">

            <div id="orientationControls">
                <h3> Orientation</h3>
                <div>
                    <label>Rotation (0-360Â°):</label>
                    <div style="display: flex; gap: 5px;">
                        <input type="range" id="angleSlider" min="0" max="360" value="{{#if angle}}{{angle}}{{else}}0{{/if}}" style="flex-grow: 1;">
                        <input type="number" id="angleInput" min="0" max="360" value="{{#if angle}}{{angle}}{{else}}0{{/if}}" style="width: 60px;">
                    </div>
                </div>

                <div style="margin-top: 10px;">
                    <label>Field of View (Width):</label>
                    <div style="display: flex; gap: 5px;">
                        <input type="range" id="fovSlider" min="10" max="180" value="{{#if fov}}{{fov}}{{else}}60{{/if}}" style="flex-grow: 1;">
                        <input type="number" id="fovInput" min="10" max="180" value="{{#if fov}}{{fov}}{{else}}60{{/if}}" style="width: 60px;">
                    </div>
                </div>
            </div>

            <hr style="width: 100%; border: 0; border-top: 1px solid #eee; margin: 15px 0;">

            <div>
                <h3> Calibration</h3>
                <input type="hidden" id="calibrationInput" value="{{calibrationC}}">
                
                {{!-- <div style="display: flex; gap: 10px; align-items: center;">
                    <label>Value (C):</label>
                    <input type="text" id="calibrationDisplay" readonly value="{{#if calibrationC}}{{calibrationC}}{{else}}Not Set{{/if}}" 
                           style="width: 80px; padding: 5px; background: #eee; border: 1px solid #ccc; color: #333;">
                </div> --}}
                <div style="display: flex; gap: 10px; align-items: center;">
                    <label>Value (C):</label>
                    <input type="number" step="0.0001" id="calibrationDisplay" value="{{calibrationC}}" 
                        placeholder="0.0"
                        oninput="document.getElementById('calibrationInput').value = this.value"
                        style="width: 100px; padding: 5px; background: #fff; border: 1px solid #ccc; color: #333;">
                </div>  
                
                <button id="openCalibBtn" style="width: 100%; padding: 8px; margin-top: 10px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    Open Calibration Tool
                </button>
            </div>
        </div>
        <div style="margin-top: auto;">
            <button id="saveBtn" style="width: 100%; padding: 15px; background: #0d6efd; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ðŸ’¾ SAVE ALL
            </button>
        </div>
    </div>
</div>

<div id="calibModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; flex-direction: column; align-items: center; justify-content: center;">
    
    <div style="background: white; padding: 20px; border-radius: 8px; max-width: 90%; max-height: 90%; display: flex; flex-direction: column; gap: 15px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0;">Calibrate Camera</h3>
            <button id="closeCalibBtn" style="background:none; border:none; font-size: 20px; cursor: pointer;">âœ–</button>
        </div>

        <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; display: flex; flex-direction: column; gap: 5px;">
            <div style="display: flex; gap: 10px; align-items: center;">
                <label style="font-weight: bold;">Reference Object:</label>
                    <select id="calibObjectSelect" style="padding: 5px; flex-grow: 1;">
                        <option value="1.7"> Person (1.7m)</option>
                        <option value="1.5"> Car (1.5m)</option>
                        <option value="2.1"> Door (2.1m)</option>
                        <option value="1.4"> Window (1.4m)</option> 
                        <option value="3.1"> Floor/Ceiling (3.1m)</option>
                        <option value="custom"> Custom Height...</option>
                    </select>
            </div>
            
            <div id="customHeightBox" style="display: none; align-items: center; gap: 10px; margin-top: 5px;">
                <label style="color: #d35400; font-weight: bold;">Enter Real Height (m):</label>
                <input type="number" id="customHeightInput" step="0.1" placeholder="0.5" style="width: 80px; padding: 5px; border: 1px solid #d35400;">
            </div>
        </div>

        <p style="font-size: 0.9em; color: #555; margin: 0;">Draw a box around the selected object below.</p>

        <div style="position: relative; border: 2px solid #333; overflow: hidden; background: black; display: flex; justify-content: center;">
            <img id="calibImg" src="" style="display: block; max-height: 50vh; max-width: 100%; object-fit: contain;">
            <canvas id="calibCanvas" style="position: absolute; top: 0; left: 0; cursor: crosshair;"></canvas>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button id="runCalibBtn" style="padding: 10px 20px; background: #2ecc71; color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer;">
                CALCULATE
            </button>
        </div>
    </div>
</div>

<div id="statusToast">Notification</div>

<script>
    const CURRENT_DEVICE_ID = "{{deviceId}}";
    const CURRENT_DEVICE_TYPE = "{{deviceType}}";

</script>